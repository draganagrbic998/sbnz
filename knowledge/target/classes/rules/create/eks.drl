package rules
import com.example.demo.model.Account
import com.example.demo.model.Bill
import com.example.demo.model.BillStatus
import com.example.demo.model.BillType
import com.example.demo.rules.BillRequest
import com.example.demo.rules.BillResponse


rule "EKS of 100%"
	agenda-group "create-rules"
	salience 5

    when
    	Account($bills: bills)
    	BillRequest($type: type)
		$response: BillResponse(valid, points != null, eks == null, $points: points)
		accumulate(
			Bill($b: this, sameType($type)) from $bills,
			$cnt: count($b) 
		)
		eval(
			$points == 5 || 
			$cnt == 0
		)
    then
    	modify($response){setEks(1.0), setReward(5000);}

end

rule "EKS of 98%"
	agenda-group "create-rules"
	salience 4

    when
    	Account($bills: bills)
    	BillRequest($type: type)
		$response: BillResponse(valid, points != null, eks == null, $points: points)
		accumulate(
			Bill($b: this, type == $type) from $bills,
			$cnt: count($b) 
		)
		eval(
			$points == 4 || 
			($type == BillType.EUR || $type == BillType.USD) && $cnt == 0
		)
    then
    	modify($response){setEks(0.98), setReward(2000);}

end

rule "EKS of 95%"
	agenda-group "create-rules"
	salience 3

    when
    	Account($bills: bills)
    	BillRequest($type: type)
		$response: BillResponse(valid, points != null, eks == null, $points: points)
		accumulate(
			Bill($b: this, type == $type) from $bills,
			$cnt: count($b) 
		)
		eval(
			$points == 3 || 
			($type == BillType.CHF || $type == BillType.GBP) && $cnt == 0
		)
    then
    	modify($response){setEks(0.95), setReward(1000);}

end

rule "EKS of 90%"
	agenda-group "create-rules"
	salience 2

    when
    	Account($bills: bills)
    	BillRequest($type: type)
		$response: BillResponse(valid, points != null, eks == null, $points: points)
		accumulate(
			Bill($b: this, status == BillStatus.ACTIVE, type == BillType.RSD) from $bills,
			$cnt: count($b) 
		)
		eval(
			$points == 2 || 
			$type == BillType.RSD && $cnt == 0
		)
    then
    	modify($response){setEks(0.9), setReward(500);}

end

rule "EKS of 87%"
	agenda-group "create-rules"
	salience 1

    when
    	Account($bills: bills)
    	BillRequest($type: type)
		$response: BillResponse(valid, points != null, eks == null, $points: points)
		accumulate(
			Bill($b: this, status == BillStatus.ACTIVE, type != BillType.RSD) from $bills,
			$cnt: count($b) 
		)
		eval(
			$points == 1 || 
			$type != BillType.RSD && $cnt == 0
		)
    then
    	modify($response){setEks(0.87), setReward(200);}

end

rule "EKS of 85%"
	agenda-group "create-rules"
	salience 0

    when
		$response: BillResponse(valid, points != null, eks == null, $points: points)
    then
    	modify($response){setEks(0.85), setReward(0);}

end

