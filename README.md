# Експертски систем за коришћење штедних рачуна

## Чланови тима
- Драгана Грбић SW22/2017
- Петар Николић SW31/2017

## Мотивација
Потреба људи за неким видом штедње све је већа, а то представља савршену прилику банкарским кућама да осмисле различите политике штедње које ће им привући што већи број клијената. Класичан принцип отварања штедног рачуна јесте тај да сама банка дефинише низ табела којe одговарајући период орочења мапирају на одређену каматну стопу и остале параметре. Поставља се питање колико просечна особа може да се снађе у таквом изобиљу понуда. 

Код свих банака чије понуде смо проучили принцип је мање више исти - банке дефинишу табеле које корисник мора самостално да анализира како би пронашао колону која му највише одговара, а то може бити веома фрустрирајуће. Било би добро када би сам корисник могао да дефинише колико би новца могао да орочи и на колики период, а да му банка потом одговори да ли је могуће успоставити одговарајући уговор и, уколико јесте, да му представи услове и каматне стопе које би том приликом остварио. Наш циљ биће управо то, имплементација система који ће користити експертско знање из домена банкарских штедних рачуна, како би омогућио флексибилније отварање штедног рачуна.

## Опис проблема
Циљ је имплементирати систем који ће омогућавати клијентима флексибилније отварање штедних рачуна. Клијентима ће приликом отварања рачуна бити омогућено да сами дефинишу количину новца коју могу да уложе и период на који планирају да ороче штедњу, а потом ће добити одговор да ли је банка у могућности да им предложи одговарајући уговор и, уколико јесте, представи каматне стопе које ће се користити приликом обрачуна месечних средстава.

Такође, идеја је у систем укључити и праћење ранијих активности корисника, како би му се омогућиле евентуалне повластице. На пример, када се корисник одлучи на отварање новог рачуна, биће награђен ако је дужи период клијент банке, ако је активно (у скорашње време) користио рачуне итд. На основу тога, систем ће приликом отварања рачуна одредити број поена који може имати утицаја приликом рачунања месечне каматне стопе. Већи број поена значиће вишу каматну стопу.

Додатно, корисницима ће бити пружена могућност превременог гашења рачуна, доплате средстава и продужетка орочења, уколико за то постоје услови. Корисницима ће бити омогућено да за сваки рачун пошаљу захтев за акцију, али ће банка, пре но што је одобри, обавити проверу постојања услова за извршење. На пример, биће спречена претерано учестала доплата средстава на један исти рачун или превелико продужење орочења итд.

## Методологија рада
Апликација познаје три врсте корисника:
- Администратор
- Службеник
- Клијент

Администратору су доступне следеће акције:
- пријава
- промена лозинке
- преглед, пагинација и претрага свих регистрованих корисника (администратора, службеника и клијената)
- регистрација новог службеника
- измена постојећег службеника
- брисање постојећег службеника

Службенику су доступне следеће акције:
- пријава
- промена лозинке
- преглед, пагинација и претрага свих отворених клијентских налога, односно рачуна (мисли се на главни рачун у банци, не на штедне рачуне, њима има приступ само власник рачуна)
- отварање новог налога у банци
- измена постојећег налога у банци
- брисање налога за које није везан ниједан активан штедни рачун (активан штедни рачун је рачун којем још увек није истекао период орочења)
- **увид у извештај**

Клијенту су доступне следеће акције:
- пријава
- промена лозинке
- преглед отвореног налога у банци
- преглед, пагинација и претрага свих отворених штедних рачуна
- **отварање штедног рачуна** (подразумева проверу услова, рачунање номиналне и ефективне каматне стопе, броја поена и додатне награде и умањује износ на главном рачуну за одабрану главницу)
- **доплата средстава на штедни рачун** (подразумева проверу услова и корекцију главнице и ефективне каматне стопе и умањује износ на главном рачуну за одабрану суму)
- **продужетак орочења штедног рачуна** (подразумева проверу услова и корекцију ефективне каматне стопе)
- **превремено гашење штедног рачуна** (подразумева проверу услова)
- преглед претходно извршених доплата за одабран рачун
- преглед претходних продужења орочења за одабран рачун

Главне акције су оне за које се покреће резонар са одговарајућим правилима и означене су тамним словима. За доплату средстава улаз представља одабран рачун и износ који жели да се доплати. За продужетак орочења улаз представља одабран рачун и број месеци за који се рачун жели продужити. За превремено гашење улаз је само одабран рачун. Уколико је резонар успоставио да су задовољени услови за извршење акције, излаз је потврдан одговор и, у случају доплате и продужења орочења, нове вредности ефективне каматне стопе и главнице. У супротном, излаз је одричан одговор, са додатним појашњењем. 

За отварање штедног рачуна улаз представља врста рачуна (динарски или девизни), главница (почетни износ на рачуну) и период орочења изражен у броју месеци. Уколико корисник одабере девизни рачун, бира и одговарајућу валуту (еври, амерички долари, швајцарски франци или британске фунте). Излаз акције представља одговор које је потврдан уколико је могуће остварити уговор за унету главницу и период орочења, у супротном је одричан и праћен додатним појашњењем. Ако је одговор потврдан, додатни параметри излаза су: номинална каматна стопа, број остварених поена, ефективна каматна стопа и додатна награда.

Идентификоване класе и зависност између њих приказани су на клас дијаграму. Класа <b>User</b> представља апстракцију све три врсте корисника. Класа <b>Authority</b> служи за регистрацију корисничких улога (у нашем случају то су администратор, службеник и клијент). Класа <b>Account</b> представља налог отворен у банци, односно главни клијентски рачун. Он је искључиво динарски и са њега се преузимају средства потребна за отварање штедних рачуна и евентуалне касније доплате. Класа <b>Bill</b> представља апстракцију динарског или девизног рачуна (тип рачуна одређен је пољем type). Класа <b>Transaction</b> представља запис у систему када је извршена одговарајућа доплата средстава на штедни рачун. Класа <b>Renewal</b> представља запис у систему када је извршено продужење орочења рачуна.

<div align="center">
  <img src="https://github.com/draganagrbic998/sbnz/blob/main/class.png" alt="drawing"/>
</div>

## База знања
Базу знања чине четири групе правила. То су, редом, правила која дефинишу политику отварања штедног рачуна, доплате средстава, продужења орочења штедног рачуна и превременог гашења штедног рачуна.

### 1. Правила за отварање штедног рачуна
Група правила која дефинишу предуслове отварања штедног рачуна и начине на који се рачунају каматне стопе које ће се користити приликом обрачуна месечних средстава.

#### А. Противуслови отварања штедног рачуна
Правила која дефинишу недозвољене ситуације приликом захтева за отварањем рачуна. Уколико је **барем једна од ситуација задовољена**, отварање рачуна биће спречено.

##### Отварање штедног рачуна је онемогућено у следећим случајевима:
- Корисник је одабрао динарски рачун са главницом мањом од 10.000 РСД.
- Корисник је одабрао динарски рачун са главницом већом од 10.000.000 РСД.
- Корисник је одабрао динарски рачун са бројем месеци мањим од 4.
- Корисник је одабрао динарски рачун са бројем месеци већим од 42.
- Корисник је одабрао динарски рачун са главницом која када би се скинула са главног рачуна, на њему не би остало барем 200 РСД.
- Корисник је малолетан и одабрао је динарски рачун са главницом већом од 100.000 РСД.
- Корисник је малолетан и одабрао је динарски рачун, а већ поседује 2 активна динарска рачуна.
- Корисник је одабрао девизни рачун са главницом мањом од 100 јединица валуте.
- Корисник је одабрао девизни рачун са главницом већом од 100.000 јединица валуте.
- Корисник је одабрао девизни рачун са бројем месеци мањим од 2.
- Корисник је одабрао девизни рачун са бројем месеци већим од 36.
- Корисник је одабрао девизни рачун са главницом која када би се скинула са главног рачуна, на њему не би остало барем 1.000 РСД.
- Корисник је малолетан и одабрао је девизни рачун са главницом већом од 1.000 јединица валуте.
- Корисник је малолетан и одабрао је девизни рачун, а већ поседује 1 активан девизни рачун.

#### Б. Правила за рачунање номиналне каматне стопе
Номинална каматна стопа служи за рачунање коначне месечне каматне стопе. Рачуна се посебно за сваку валуту и одабране вредности периода орочења и главнице. За сваку подгрупу правила неопходно је да је **барем један од услова задовољен**. Приликом резоновања, узима се најповољнија каматна стопа.

##### Камата износи 1.5%
- Корисник је одабрао динарски рачун са бројем месеци већим од 21 или главницом која када се подели са бројем месеци износи више од 100.000 РСД.
- Корисник је одабрао девизни рачун у еврима са бројем месеци већим од 30 или главницом која када се подели са бројем месеци износи више од 3.000 еври.
- Корисник је одабрао девизни рачун у америчким доларима са бројем месеци већим од 27 или главницом која када се подели са бројем месеци износи више од 2.900 долара.
- Корисник је одабрао девизни рачун у швајцарским францима са бројем месеци већим од 24 или главницом која када се подели са бројем месеци износи више од 2.800 франака.
- Корисник је одабрао девизни рачун у британским фунтама са бројем месеци већим од 33 или главницом која када се подели са бројем месеци износи више од 3.010 фунти.

##### Камата износи 1.2%
- Корисник је одабрао динарски рачун са бројем месеци већим од 15 или главницом која када се подели са бројем месеци износи више од 50.000 РСД.
- Корисник је одабрао девизни рачун у еврима са бројем месеци већим од 24 или главницом која када се подели са бројем месеци износи више од 2.000 еври.
- Корисник је одабрао девизни рачун у америчким доларима са бројем месеци већим од 21 или главницом која када се подели са бројем месеци износи више од 1.900 долара.
- Корисник је одабрао девизни рачун у швајцарским францима са бројем месеци већим од 18 или главницом која када се подели са бројем месеци износи више од 1.800 франака.
- Корисник је одабрао девизни рачун у британским фунтама са бројем месеци већим од 27 или главницом која када се подели са бројем месеци износи више од 2.100 фунти.

##### Камата износи 1.0%
- Корисник је одабрао динарски рачун са бројем месеци већим од 9 или главницом која када се подели са бројем месеци износи више од 30.000 РСД.
- Корисник је одабрао девизни рачун у еврима са бројем месеци већим од 18 или главницом која када се подели са бројем месеци износи више од 1.000 еври.
- Корисник је одабрао девизни рачун у америчким доларима са бројем месеци већим од 15 или главницом која када се подели са бројем месеци износи више од 900 долара.
- Корисник је одабрао девизни рачун у швајцарским францима са бројем месеци већим од 12 или главницом која када се подели са бројем месеци износи више од 800 франака.
- Корисник је одабрао девизни рачун у британским фунтама са бројем месеци већим од 21 или главницом која када се подели са бројем месеци износи више од 1.100 фунти.

##### Камата износи 0.8%
- Корисник је одабрао динарски рачун са бројем месеци већим од 6 или главницом која када се подели са бројем месеци износи више од 10.000 РСД.
- Корисник је одабрао девизни рачун у еврима са бројем месеци већим од 12 или главницом која када се подели са бројем месеци износи више од 500 еври.
- Корисник је одабрао девизни рачун у америчким доларима са бројем месеци већим од 9 или главницом која када се подели са бројем месеци износи више од 480 долара.
- Корисник је одабрао девизни рачун у швајцарским францима са бројем месеци већим од 6 или главницом која када се подели са бројем месеци износи више од 470 франака.
- Корисник је одабрао девизни рачун у британским фунтама са бројем месеци већим од 15 или главницом која када се подели са бројем месеци износи више од 520 фунти.

##### Камата износи 0.5%
- Корисник је одабрао динарски рачун са бројем месеци не већим од 6 и главницом која када се подели са бројем месеци износи не више од 10.000 РСД.
- Корисник је одабрао девизни рачун у еврима са бројем месеци не већим од 12 и главницом која када се подели са бројем месеци износи не више од 500 еври.
- Корисник је одабрао девизни рачун у америчким доларима са бројем месеци не већим од 9 и главницом која када се подели са бројем месеци износи не више од 480 долара.
- Корисник је одабрао девизни рачун у швајцарским францима са бројем месеци не већим од 6 и главницом која када се подели са бројем месеци износи не више од 470 франака.
- Корисник је одабрао девизни рачун у британским фунтама са бројем месеци не већим од 15 и главницом која када се подели са бројем месеци износи не више од 520 фунти.

#### В. Правила за рачунање бонус поена
Поред номиналне каматне стопе, у систем је укључена и могућност коришћења повластица - повољније камате уколико је корисник високо бодован, односно забележен као квалитетан клијент. За сваку подгрупу правила неопходно је да је **барем два услова задовољено**. Приликом резоновања, узима се најповољнији број поена.

##### 5 поена
- Корисник има отворен рачун у банци барем 5 година.
- У последњих 9 месеци кориснику је забележено отварање барем 2 динарска рачуна са главницом већом од 200.000 РСД.
- У последњих 12 месеци кориснику је забележено отварање барем 1 девизног рачуна са главницом већом од 2.000 јединица валуте.
- У последњих 9 месеци просечна вредност главнице на свим динарским рачунима износи барем 100.000 РСД.
- У последњих 12 месеци просечна вредност главнице на свим девизним рачунима износи барем 1.000 јединица валуте.

##### 4 поена
- Корисник има отворен рачун у банци барем 4 године.
- У последњих 9 месеци кориснику је забележено отварање барем 2 динарска рачуна са бројем месеци већим од 12.
- У последњих 12 месеци кориснику је забележено отварање барем 1 девизног рачуна са бројем месеци већим од 9.
- У последњих 9 месеци сума свих главница на свим динарским рачунима износи барем 300.000 РСД.
- У последњих 12 месеци сума свих главница на свим девизним рачунима износи барем 3.000 јединица валуте.

##### 3 поена
- Корисник има отворен рачун у банци барем 3 године.
- У последњих 9 месеци кориснику је забележено отварање барем 2 динарска рачуна на којима је извршено више од 2 уплате са износом од барем 10.000 РСД.
- У последњих 12 месеци кориснику је забележено отварање барем 1 девизног рачуна на којем је извршено више од 1 уплате са износом од барем 100 јединица валуте.
- У последњих 9 месеци кориснику је забележено отварање барем 2 динарска рачуна на којима је сума свих уплата већа од 30% главнице.
- У последњих 12 месеци кориснику је забележено отварање барем 1 девизног рачуна на којем је сума свих уплата већа од 20% главнице.

##### 2 поена
- Корисник има отворен рачун у банци барем 2 године.
- У последњих 9 месеци кориснику је забележено отварање барем 2 динарска рачуна којима је главница већа од 50.000 РСД и просек свих уплата већи од 10.000 РСД.
- У последњих 12 месеци кориснику је забележено отварање барем 1 девизног рачуна којем је главница већа од 500 јединица валуте и просек свих уплата већи од 100 јединица валуте.
- У последњих 9 месеци кориснику је просек свих уплата на свим динарским рачунима барем 50.000 РСД.
- У последњих 12 месеци кориснику је просек свих уплата на свим девизним рачунима барем 500 јединица валуте.

##### 1 поен
- Корисник има отворен рачун у банци барем 1 годину.
- У последњих 9 месеци кориснику је забележено отварање барем 2 динарска рачуна којима је број месеци већи од 6 и сума свих уплата већа од 10.000 РСД.
- У последњих 12 месеци кориснику је забележено отварање барем 1 девизног рачуна којем је број месеци већи од 3 и сума свих уплата већа од 100 јединица валуте.
- У последњих 9 месеци кориснику је сума свих уплата на свим динарским рачунима барем 80.000 РСД.
- У последњих 12 месеци кориснику је сума свих уплата на свим девизним рачунима барем 800 јединица валуте.

#### Г. Правила за рачунање ефективне каматне стопе
Ефективна каматна стопа је коначна каматна стопу која се користи приликом обрачуна месечних средстава и представља проценат номиналне каматне стопе. Код 95% банака које смо гледали, ова каматна стопа је фиксна и износи 85%. У нашем случају то ће вити подразумевана вредност, али ћемо дозволити њено повећање уколико је корисник високо бодован.
За сваку подгрупу правила неопходно је да је **барем један од услова задовољен**. Приликом резоновања, узима се најповољнија каматна стопа.

##### Камата износи 100% и корисник добија награду од 5000 динара
- Корисник је бодован са 5 поена.
- Корисник отвара први динарски рачун.
- Корисник отвара први девизни рачун.

##### Камата износи 98% и корисник добија награду од 2000 динара
- Корисник је бодован са 4 поена.
- Корисник отвара први девизни рачун у еврима.
- Корисник отвара први девизни рачун у америчким доларима.

##### Камата износи 95% и корисник добија награду од 1000 динара
- Корисник је бодован са 3 поена.
- Корисник отвара први девизни рачун у швајцарским францима.
- Корисник отвара први девизни рачун у британским фунтама.

##### Камата износи 90% и корисник добија награду од 500 динара
- Корисник је бодован са 2 поена.
- Корисник отвара динарски рачун, а сви претходни су затворени.

##### Камата износи 87% и корисник добија награду од 200 динара
- Корисник је бодован са 1 поеном.
- Корисник отвара девизни рачун, а сви претходни су затворени.

#### Д. Повезивање правила за отварање штедног рачуна
Групу правила за отварање штедног рачуна чини четири слоја (четири нивоа forward chaining-a) - слој за откривање недозвољених ситуација, слој за рачунање номиналне каматне стопе, слој за рачунање бонус поена и слој за рачунање ефективне каматне стопе и додатне награде. Правила се повезују редоследом којим су наведени, што се види на слици испод. Прво се извршавају правила која проверавају недозвољене ситуације. Уколико се није десила ниједна недозвољена ситуација, позивају се правила за рачунање номиналне каматне стопе. Након тога, позивају се правила за рачунање бонус поена и на крају се рачуна ефективна каматна стопа и додатна награда. Излаз из сва четири слоја представљају израчунате вредности номиналне и ефективне каматне стопе, бонус поена и додатне награде, уколико се није десила нека забрањена ситуација. Уколико се десила, излаз је одрична порука са додатним појашењењем. 

<div align="center">
  <img src="https://github.com/draganagrbic998/sbnz/blob/main/diagram1.png" alt="drawing"/>
</div>

### 2. Правила за доплату средстава на штедни рачун
Група правила која дефинишу предуслове за доплату средстава на штедни рачун, као и начине корекције главнице и ефективне каматне стопе.

#### А. Противуслови доплате средстава
Правила која дефинишу недозвољене ситуације приликом захтева за доплатом средстава. Уколико је **барем једна од ситуација задовољена**, доплата ће бити спречена.

##### Доплата средстава је онемогућена у следећим случајевима:
- Прошло је мање од 5% периода орочења.
- Прошло је више од 95% периода орочења.
- Корисник је одабрао износ који је мањи од 10% постојећег износа на штедном рачуну.
- Корисник је одабрао износ који је већи 50% постојећег износа на штедном рачуну.
- Корисник је одабрао динарски рачун отворен на мање од 6 месеци.
- Корисник је одабрао динарски рачун са главницом мањом од 75.000 РСД.
- Корисник је одабрао динарски рачун, а већ је извршио 5 уплата на њему.
- Корисник је одабрао девизни рачун отворен на мање од 4 месеца.
- Корисник је одабрао девизни рачун са главницом мањом од 750 јединица валуте.
- Корисник је одабрао девизни рачун, а већ је извршио 3 уплате на њему.

##### Онемогућена је доплата више од 40% постојећег износа на штедном рачуну уколико:
- Корисник је одабрао динарски рачун са главницом већом од 200.000 РСД.
- Корисник је одабрао динарски рачун и поседује више од 3 активна динарска рачуна.
- Корисник је одабрао динарски рачун и до сада је на одабраном рачуну уплатио више од 50% главнице.
- Корисник је одабрао девизни рачун са главницом већом од 2.000 јединица одабране валуте.
- Корисник је одабрао девизни рачун и поседује више од 2 активнa девизнa рачуна.
- Корисник је одабрао девизни рачун и до сада је на одабраном рачуну уплатио више од 30% главнице.

##### Онемогућена је доплата више од 35% постојећег износа на штедном рачуну уколико:
- Корисник је одабрао динарски рачун са главницом већом од 150.000 РСД.
- Корисник је одабрао динарски рачун и поседује више од 4 активна динарска рачуна.
- Корисник је одабрао динарски рачун и до сада је на одабраном рачуну уплатио више од 60% главнице.
- Корисник је одабрао девизни рачун са главницом већом од 1.500 јединица одабране валуте.
- Корисник је одабрао девизни рачун и поседује више од 3 активна девизна рачуна.
- Корисник је одабрао девизни рачун и до сада је на одабраном рачуну уплатио више од 40% главнице.

##### Онемогућена је доплата више од 30% постојећег износа на штедном рачуну уколико:
- Корисник је одабрао динарски рачун са главницом већом од 100.000 РСД.
- Корисник је одабрао динарски рачун и поседује више од 5 активна динарска рачуна.
- Корисник је одабрао динарски рачун и до сада је на одабраном рачуну уплатио више од 70% главнице.
- Корисник је одабрао девизни рачун са главницом већом од 1.000 јединица одабране валуте.
- Корисник је одабрао девизни рачун и поседује више од 4 активна девизна рачуна.
- Корисник је одабрао девизни рачун и до сада је на одабраном рачуну уплатио више од 50% главнице.

#### Б. Правила за корекцију главнице
Правила која дефинишу начинe на које се коригује главница приликом доплате средстава. За сваку подгрупу правила неопходно је да је **барем један од услова задовољен**. Приликом резоновања, узима се најповољнија корекција главнице. 

##### Главница се увећава за 90% уплате
- Уплата износи више од 40% главнице.
- Стање на динарском рачуну износи више од 300.000 РСД.
- Стање на девизном рачуну износи више од 3.000 јединица одабране валуте.
- Корисник је током последњих 5 месеци на одабраном рачуну уплатио више од 50% главнице.

##### Главница се увећава за 80% уплате
- Уплата износи више од 35% главнице.
- Стање на динарском рачуну износи више од 250.000 РСД.
- Стање на девизном рачуну износи више од 2.500 јединица одабране валуте.
- Корисник је током последњих 6 месеци на одабраном рачуну уплатио више од 45% главнице.

##### Главница се увећава за 70% уплате
- Уплата износи више од 30% главнице.
- Стање на динарском рачуну износи више од 200.000 РСД.
- Стање на девизном рачуну износи више од 2.000 јединица одабране валуте.
- Корисник је током последњих 7 месеци на одабраном рачуну уплатио више од 40% главнице.

##### Главница се увећава за 60% уплате
- Уплата износи више од 25% главнице.
- Стање на динарском рачуну износи више од 150.000 РСД.
- Стање на девизном рачуну износи више од 1.500 јединица одабране валуте.
- Корисник је током последњих 8 месеци на одабраном рачуну уплатио више од 35% главнице.

##### Главница се увећава за 50% уплате
- Уплата износи не више од 25% главнице.
- Стање на динарском рачуну износи не више од 1500.00 РСД.
- Стање на девизном рачуну износи не више од 1.500 јединица одабране валуте.
- Корисник је током последњих 8 месеци на одабраном рачуну уплатио не више од 35% главнице.

#### В. Правила за корекцију ефективне каматне стопе
Правила која дефинишу начине на које се коригује ефективна каматна стопа приликом доплате средстава. За сваку подгрупу правила неопходно је да је **барем један од услова задовољен**. Приликом резоновања, узима се највеће умањење каматне стопе. 

##### Камата се умањује за 3%
- Уплата износи више од 35% главнице.
- Стање на динарском рачуну износи више од 330.000 РСД.
- Стање на девизном рачуну износи више од 3.300 јединица одабране валуте.
- Корисник је током последњих 12 месеци на динарским рачунима уплатио у просеку више од 50% износа на главном рачуну.
- Корисник је током последњих 11 месеци на девизним рачунима уплатио у просеку више од 45% износа на главном рачуну.

##### Камата се умањује за 2.5%
- Уплата износи више од 30% главнице.
- Стање на динарском рачуну износи више од 270.000 РСД.
- Стање на девизном рачуну износи више од 2.700 јединица одабране валуте.
- Корисник је током последњих 11 месеци на динарским рачунима уплатио у просеку више од 45% износа на главном рачуну.
- Корисник је током последњих 10 месеци на девизним рачунима уплатио у просеку више од 40% износа на главном рачуну.

##### Камата се умањује за 2%
- Уплата износи више од 25% главнице.
- Стање на динарском рачуну износи више од 220.000 РСД.
- Стање на девизном рачуну износи више од 2.200 јединица одабране валуте.
- Корисник је током последњих 10 месеци на динарским рачунима уплатио у просеку више од 40% износа на главном рачуну.
- Корисник је током последњих 9 месеци на девизним рачунима уплатио у просеку више од 35% износа на главном рачуну.

##### Камата се умањује за 1.5%
- Уплата износи више од 20% главнице.
- Стање на динарском рачуну износи више од 180.000 РСД.
- Стање на девизном рачуну износи више од 1.800 јединица одабране валуте.
- Корисник је током последњих 9 месеци на динарским рачунима уплатио у просеку више од 35% износа на главном рачуну.
- Корисник је током последњих 8 месеци на девизним рачунима уплатио у просеку више од 30% износа на главном рачуну.

##### Камата се умањује за 1%
- Уплата износи не више од 20% главнице.
- Стање на динарском рачуну износи не више од 180.000 РСД.
- Стање на девизном рачуну износи не више од 1.800 јединица одабране валуте.
- Корисник је током последњих 9 месеци на динарским рачунима уплатио у просеку не више од 35% износа на главном рачуну.
- Корисник је током последњих 8 месеци на девизним рачунима уплатио у просеку не више од 30% износа на главном рачуну.

#### Г. Повезивање правила за доплату средстава
Групу правила за доплату средстава чини три слоја (три нивоа forward chaining-a) - слој за откривање недозвољених ситуација, слој за корекцију главнице и слој за корекцију ефективне каматне стопе. Слојеви се повезују редоследом којим су наведени, што се види на слици испод. Прво се извршавају правила која проверавају недозвољене ситуације. Уколико се није десила ниједна недозвољена ситуација, позивају се правила за корекцију главнице, а потом правила за корекцију ефективне каматне стопе. На излазу из сва три слоја налазе се нове вредности главнице и каматне стопе, уколико се није десила нека забрањена ситуација. Уколико се десила, излаз је одрична порука са додатним појашњењем.

<div align="center">
  <img src="https://github.com/draganagrbic998/sbnz/blob/main/diagram2.png" alt="drawing"/>
</div>

### 3. Правила за продужење орочења штедног рачуна
Група правила која дефинишу предуслове за продужење орочења штедног рачуна, као и начине корекције ефективне каматне стопе приликом одобреног продужења.

#### А. Противуслови продужења орочења
Правила која дефинишу недозвољене ситуације приликом захтева за продужењем орочења. Уколико је **барем једна од ситуација задовољена**, продужетак ће бити спречен.

##### Продужење орочења је онемогућено у следећим случајевима:
- Корисник је одабрао мање од 3 месеца продужења.
- Корисник је одабрао више од 24 месеца продужења.
- Корисник је одабрао динарски рачун са минималним периодом орочења од 4 месеца.
- Корисник је одабрао динарски рачун са периодом орочења од барем 42 месеца.
- Корисник је одабрао динарски рачун са главницом мањом од 75.000 РСД.
- Корисник је одабрао девизни рачун са минималним периодом орочења од 2 месеца.
- Корисник је одабрао девизни рачун са периодом орочења од барем 36 месеци.
- Корисник је одабрао девизни рачун са главницом мањом од 750 јединица одабране валуте.

##### Онемогућено је продужење орочења на више од 18 месеци уколико:
- Корисник је одабрао динарски рачун са главницом мањом од 250.000 РСД.
- Корисник је одабрао девизни рачун са главницом мањом од 2.500 јединица одабране валуте.
- Корисник је одабран рачун већ једном продужио.

##### Онемогућено је продужење орочења на више од 12 месеци уколико:
- Корисник је одабрао динарски рачун са главницом мањом од 200.000 РСД.
- Корисник је одабрао девизни рачун са главницом мањом од 2.000 јединица одабране валуте.
- Корисник је одабран рачун већ 2 пута продужио.

##### Онемогућено је продужење орочења на више од 9 месеци уколико:
- Корисник је одабрао динарски рачун са главницом мањом од 150.000 РСД.
- Корисник је одабрао девизни рачун са главницом мањом од 1.500 јединица одабране валуте.
- Корисник је одабран рачун већ 3 пута продужио.

##### Онемогућено је продужење орочења на више од 6 месеци уколико:
- Корисник је одабрао динарски рачун са главницом мањом од 100.000 РСД.
- Корисник је одабрао девизни рачун са главницом мањом од 1.000 јединица одабране валуте.
- Корисник је одабран рачун већ 4 пута продужио.

#### Б. Правила за корекцију ефективне каматне стопе
Правила која дефинишу начине на које се коригује ефективна каматна стопа приликом одобреног продужења орочења. За сваку подгрупу правила неопходно је да је **барем један од услова задовољен**. Приликом резоновања, узима се најповољнија корекција каматне стопе. 

##### Камата се увећава за 2.5%
- Орочење је продужено за више од 16 месеци.
- Стање на динарском рачуну износи више од 270.000 РСД.
- Стање на девизном рачуну износи више од 2.700 јединица одабране валуте.
- Корисник је током последњих 24 месеца продужио динарске рачуне у просеку за више од 15 месеци.
- Корисник је током последњих 21 месеци продужио девизне рачуне у просеку за више од 14 месеци.

##### Камата се увећава за 2%
- Орочење је продужено за више од 13 месеци.
- Стање на динарском рачуну износи више од 220.000 РСД.
- Стање на девизном рачуну износи више од 2.200 јединица одабране валуте.
- Корисник је током последњих 24 месеца продужио динарске рачуне у просеку за више од 12 месеци.
- Корисник је током последњих 21 месеци продужио девизне рачуне у просеку за више од 11 месеци.

##### Камата се увећава за 1.5%
- Орочење је продужено за више од 9 месеци.
- Стање на динарском рачуну износи више од 170.000 РСД.
- Стање на девизном рачуну износи више од 1.700 јединица одабране валуте.
- Корисник је током последњих 24 месеца продужио динарске рачуне у просеку за више од 8 месеци.
- Корисник је током последњих 21 месеци продужио девизне рачуне у просеку за више од 7 месеци.

##### Камата се увећава за 1%
- Орочење је продужено за више од 5 месеци.
- Стање на динарском рачуну износи више од 120.000 РСД.
- Стање на девизном рачуну износи више од 1.200 јединица одабране валуте.
- Корисник је током последњих 24 месеца продужио динарске рачуне у просеку за више од 4 месеци.
- Корисник је током последњих 21 месеци продужио девизне рачуне у просеку за више од 3 месеци.

##### Камата се увећава за 0.5%
- Орочење је продужено за не више од 5 месеци.
- Стање на динарском рачуну износи не више од 120.000 РСД.
- Стање на девизном рачуну износи не више од 1.200 јединица одабране валуте.
- Корисник је током последњих 24 месеца продужио динарске рачуне у просеку за више од 4 месеца.
- Корисник је током последњих 21 месеци продужио девизне рачуне у просеку за више од 3 месеца.

#### В. Повезивање правила за продужење орочења
Групу правила за продужење орочења чини два слоја (два нивоа forward chaining-а) - слој за откривање недозвољених ситуација и слој за корекцију ефективне каматне стопе. Слојеви су повезани радоследом којим су наведени, што се види на слици испод. Прво се извршавају правила која проверавају недозвољене ситуације. Уколико се није десила ниједна недозвољена ситуација, позивају се правила која коригују ефективну каматну стопу. На излазу из оба слоја наћи ће се нова вредност ефективне каматне стопе, уколико се није десила нека зарањена ситуација. Уколико се десила, излаз је одрична порука са додатним појашњењем.

<div align="center">
  <img src="https://github.com/draganagrbic998/sbnz/blob/main/diagram3.png" alt="drawing"/>
</div>

### 4. Правила за превремено гашење штедног рачуна
Група правила која дефинишу предуслове за превремено гашење штедног рачуна. Ако корисник превремено угаси штедни рачун, његова главница ће бити пребачена на главни рачун.

##### Превремено гашење штедног рачуна је онемогућено у следећим случајевима:
- Прошло је мање од 20% периода орочења.
- Прошло је више од 80% периода орочења.
- Корисник је одабрао динарски рачун са главницом мањом од 20.000 РСД.
- Корисник је одабрао једини активни динарски рачун.
- Корисник је одабрао динарски рачун, а већ 6 других превремено угасио.
- Корисник је одабрао девизни рачун са главницом мањим од 200 јединица одабране валуте.
- Корисник је одабрао једини активни девизни рачун.
- Корисник је одабрао девизни рачун, а већ 4 других превремено угасио.

### 5. Увид у извештај
Извештај се састоји из два дела - генерални извештај и извештај о најактивнијим клијентима. Генерални извештај чине статистички подаци штедних рачуна, груписани према типу рачуна (динарски, девизни у еврима, америчким доларима, швајцарским францима и британским фунтама). Статистика која је од значаја је број активних и затворених рачуна, удео превремено затворених рачуна, просечна вредност главнице и периода орочења, просечна вредност доплата средстава и просечна вредност продужења орочења. Извештај о најактивнијим клијентима састоји се из три дела:
- преглед клијената који имају отворен рачун у банци барем 5 година, који су у последњих 18 месеци отворили више од 10 штедних рачуна и којима је укупна главница на свим рачунима преко 10000000 РСД
- преглед клијената који ниједном нису превремено затворили рачун, који су у последњих 18 месеци отворили више од 10 штедних рачуна на дуже од 8 месеци и којима је укупна главница на свим девизним рачунима већа од 1000000 РСД 
- преглед клијената који су у последњих 18 месеци барем 5 пута продужили штедни рачун, којима је просечна дужина продужења рачуна преко 6 месеци и којима је просечна вредност свих доплата већа од 500000 РСД

### 6. Додатна правила
###### Месечни обрачун средстава на штедним рачунима
Сваког месеца клијентима се повећава износ на штедним рачунима користећи израчунате вредност ефективне каматне стопе.
###### Пренос средстава са штедног рачуна на главни
Приликом истека орочења штедног рачуна, сав износ на њему пребацује се на главни рачун. Уколико је штедни рачун био девизни, додатно се врши конверзија у динарску валуту.
###### Обавештење о скором истицању орочења штедног рачуна
Клијент се 15 дана пре истека орочења штедног рачуна обавештава о скорашњем гашењу рачуна, како би евентуално размислио о његовом продужењу. 
###### Обавештење о могућности доплате средстава на штедни рачун
Клијент се обавештава када истекне барем 5% периода орочења штедног рачуна, како би знао да је у могућности да врши доплате средстава на њему.
###### Обавештење о могућности превременог гашења рачуна
Клијент се обавештада када истекне барем 20% периода орочења штедног рачуна, како би знао да је стекао право да га превремено угаси.
###### Обавештење о дужини главног рачуна
Клијент се обавештава када му дужина отвореног рачуна у банци достигне 1, 2, 3, 4, 5 и 10 година.
###### Упозорење о учесталом превременом гашењу рачуна
Клијент се обавештава ако је у последњих 9 месеци превремено угасио више од 3 штедна рачуна.
###### Упозорење о слабој активности
Клијент се обавештава ако у последњих 9 месеци није отворио ниједан нови штедни рачун.
###### Упозорење о ниској вредности средстава на штедним рачунима
Клијент се обавештава ако у последњих 9 месеци просечна вредност главница на свим рачунима износи испод 10.000 РСД.
###### Упозорење о кратком периоду орочења штедних рачуна
Клијент се обавештава ако у последњих 9 месеци просечни период орочења штедних рачуна износи испод 5 месеци.

## Пример резоновања
Сценарио коришћења система дат је на примеру отварања штедног рачуна.
1. Клијент жели да упути захтев за отварањем штедног рачуна. Клијент је пунолетан, отворио је главни рачун пре 18 месеци, не поседује друге штедне рачуне и одабрао је динарски рачун, главницу од 20.000 РСД и период орочења од 12 месеци, док на главном рачуну поседује 30.000 РСД.
2. Проверава се испуњеност услова из групе правила 1А. Будући да ниједан од услова није испуњен, прелази се на рачунање номиналне каматне стопе (НКС).
3. Корисник жели да отвори динарски рачун са периодом орочења од 12 месеци, што према правилима групе 1Б значи да ће НКС износити 1.0%, јер главница подељена са бројем месеци не задовољава услове веће каматне стопе. Прелази се на одређивање броја бодова клијента.
4. Једини услов који клијент задовољава из групе 1В јесте тај да је клијент банке барем 1 годину, остали не могу бити испуњени јер корисник није отварао претходно штедне рачуне. Како је за ову групу правила неопходна испуњеност барем два услова, корисник се бодује са 0 бодова. Прелази се на рачунање ефективне каматне стопе (ЕКС).
5. Како је клијент бодован са 0 бодова, приликом рачунања ЕКС посматра се број претходно отворених рачуна. Како клијент отвара први динарски рачун и није имао претходне штедне рачуне, то има за последицу испуњеност услова првог правила из група 1Г, односно ЕКС ће износити 100% и корисник ће бити награђен са 5.000 РСД.
6. Кориснику се приказују израчунате вредности каматних стопа и додатна награда и пружа прилика да предложени уговор прихвати или одбије.

## Процена тежине правила
Ову секцију смо додали како бисмо асистенту олакшали процену тежине правила и самог пројекта. Ако нам тема буде одобрена, избацићемо је из спецификације.
###### Правила тежине за оцену 6
Правила из група 1.А, 1.Б и 4. То су једноставна when-then правила, у њима се не користи accumulate и логика вишег нивоа.
###### Правила тежине за оцену 7
Правила из група 1.Г и 3.А. То су правила која користе accumulate, али им логика није вишег нигоа.
###### Правила тежине за оцену 8 и 9
Правила из група 1.В, 2.А, 2.Б, 2.В, 3.Б и извештај. То су правила која користе accumulate, логика им је вишег нивоа и врше се операције count, sum, average и collectSet над колекцијама кроз које се итерира. Треба напоменути да се у извештају користи accumulate у три нивоа (јер се пролази кроз све клијенте, па онда кроз све рачуне за појединачног клијента, па онда кроз сва продужења/трансакције за појединачни рачун), а да се у правилима из групе 1.B користи accumulate у два нивоа (јер се пролази кроз све рачуне, па онда кроз све трансакције за појединачни рачун). Зато те две групе правила процењујемо као једне од најтежих.
###### Правила тежине за оцену 10
Правила из групе 6, тј. додатна правила. Код њих се користи CEP механизам.
###### Forward chaining правила
Forward chaining се појављује у 2, 3, 4 и 5 нивоа. У 2 нивоа се појављује у 4. групи правила. У 3 нивоа се појављује и 3. групи правила. У 4 нивоа се појављује у 2. групи правила. У 5 нивоа се појављује у генералном извештају (прво се рачуна статистика за динарске рачуне, па за девизне у еврима, девизне у америчким доларима, девизне у швајцарским францима и на крају за девизне у британским фунтама)
