# Експертски систем за коришћење штедних рачуна

## Чланови тима
- Драгана Грбић SW22/2017
- Петар Николић SW31/2017

## Мотивација
Потреба људи за неким видом штедње све је већи, а то представља савршену прилику банкарским кућама да осмисле различите политике штедње код себе, а које ће им привући што већи број клијената. Класичан принцип отварања штедног рачуна јесте тај да сама банка дефинише низ табела који одговарајући период орочења мапира на одговарајућу каматну стопу и остале параметре. Поставља се питање колико просечна особа може да се снађе у таквом изобиљу понуда. 

Код свих банака које смо гледали принцип је мање више исти - банке дефинишу табеле које корисник мора самостално да анализира како би пронашао колону која му највише одговара, а то може бити веома фрустрирајуће. Било би добро када би сам корисник могао да дефинише колико би новца могао да орочи и на колики период, а да му потом банка одговори да ли је могуће успоставити одговарајући уговор за унете параметре и, уколико јесте, да му представи услове и каматне стопе које би том приликом остварио. Наш циљ биће управо то, имплементација система који ће користити експертско знање из домена банкарских штедних рачуна, како би омогућио фклексибилније отварање штедног рачуна.

## Опис проблема
Циљ је имплементирати систем који ће омогућавати својим клијентима флексибилније отварање штедних рачуна. Клијентима ће бити омогућено да приликом отварања рачуна сами дефинишу количину новца коју тренутно могу да уложе и период на који планирају да ороче штедњу, а потом ће добити одговор да ли је банка у могућности да им предложи одговарајући уговор и, уколико јесте, представи каматне стопе које ће се користити приликом месечног обрачуна средстава. 

Такође, идеја је у систем укључити и праћење ранијих активности корисника, како би му се омогућиле евентуалне повластице. На пример, када се корисник одлучи на отварање новог штедног рачуна, биће награђен ако је дужи период клијент банке, ако није са великом учесталошћу гасио претходне рачуне, није често повлачио новац са штедних рачуна пре истека орочења и тако даље. На основу тога, систем ће приликом отварања рачуна одредити број поена који може имати утицаја приликом рачунања месечне каматне стопе. Већи број поена значиће вишу каматну стопу.

Додатно, корисницима ће бити пружена могућност доплате средстава на штедним рачунима, повлачење средстава, продужетак орочења и превремено гашење, уколико се покаже да за то услови постоје. Корисницима ће бити омогућено да за сваки рачун пошаљу захтев за неком од наведених акција, али ће банка, пре него што акцију одобри, вршити проверу услова за њено извршавање. На пример, биће спречен захтев који би повлачио износ већи од 50% укупних средстава на рачуну или претерано учесталу уплату средстава на један исти штедни рачун итд.

## Методологија рада
Апликација познаје три врсте корисника:
- Администратор
- Службеник
- Клијент

Администратору су доступне следеће акције:
- пријава
- промена лозинке
- преглед, пагинација и претрага свих регистрованих корисника (администратора, службеника и клијената)
- регистрација новог службеника
- измена постојећег службеника
- брисање постојећег службеника
- увид у извештај - број активних и  број затворених штедних рачуна, удео превремо угашених рачуна, број корисника динарских и број корисника девизних рачуна, просечан износ главнице, просена дужина орочења, просечна висина доплата и повлачења новца са рачуна, број продужених орочења

Службенику су доступне следеће акције:
- пријава
- промена лозинке
- преглед, пагинација и претрага свих отворених клијентских налога, односно рачуна (мисли се на главни рачун у банци, не на штедне рачуне, њима има приступ само власник рачуна)
- отварање новог налога у банци
- измена постојећег налога у банци
- брисање налога за које није везан ниједан активан штедни рачун (активан штедни рачун је рачун којем још увек није истекао период орочења)

Клијенту су доступне следеће акције:
- пријава
- промена лозинке
- преглед отвореног налога у банци
- преглед, пагинација и претрага свих отворених штедних рачуна
- **отварање новог штедног рачуна** (подразумева проверу услова, рачунање номиналне и ефектине каматне стопе и броја поена и умањење износа на главном рачуну за одабрану главницу)
- **доплата новца на активни штедни рачун** (подразумева проверу услова, умањење износа на главном рачуну за одабрану суму и корекцију главнице и ефективне каматне стопе)
- **повлачење новца са активног штедног рачуна** (подразумева проверу услова и увећање износа на главном рачуну за одабрану суму)
- **продужетак орочења штедног рачуна** (подразумева проверу услова и корекцију каматне стопе)
- **превремено гашење штедног рачуна** (подразумева проверу услова за гашење рачуна)
- преглед претходно извршених трансакција (доплата, повлачење новца) за одабран рачун
- преглед претходних продужења орочења за одабран рачун

Главне акције су оне за које се покреће резонар са одговарајућим правилима и означене су тамним словима. За уплату и повлачење средстава са штедног рачуна улаз представља одабран рачун и износ који жели да се уплати/повуче. За продужетак орочења штедног рачуна улаз је одабран рачун и број месеци за који се рачун жели продужити. За превремено гашење рачуна улаз је само одабран рачун. За све акције излаз је потврдан или одричан одговор, потврдан уколико је резонар успоставио да су задовољени услови за извршавање акције, а одричан у супротном.

За отварање штедног рачуна улаз представља врста рачуна (динарски или девизни), главница (почетни износ на рачуну) и период орочења изражен у броју месеци. Уколико корисник одабере девизни рачун, бира и одговарајућу валуту (еври, амерички долари, швајцарски франци, бринтански фунти или руски динари). Излаз акције такође представља одговор који може бити потврдан уколико је могуће остварити уговор за унету главницу и период орочења, или одричан ако није, уз пропратно образложење о разлогу одбијања. Ако је одговор потрвдан, додатни параметри излаза су: номилана каматна стопа, број остварених поена и ефективна каматна стопа. Ефективна каматна стопа представља месечну каматну стопу за обрачун средстава.

Идентификоване класе и зависност између њих приказани су на клас дијаграму. Класа <b>User</b> представља апстракцију све три врсте корисника. Класа <b>Authority</b> служи за регистрацију корисничких улога (у нашем случају то су администратор, службеник и клијент). Класа <b>Account</b> представља налог отворен у банци, односно главни клијентски рачун. Са њега се преузимају средства потребна за отварање штедних рачуна и евентуалне касније доплате. Такође, на њега се пребацује новац приликом повлачења новца са штедног рачуна. Класа <b>Bill</b> представља апстракцију динарског или девизног рачуна (тип рачуна одређен је пољем type). Класа <b>Transaction</b> представља запис у систему када је извршена одговарајућа доплата или повлачење новца са штедног рачуна. Класа <b>Renewal</b> представља запис у систему када је извршен продужетак орочења рачуна.

<div align="center">
  <img src="https://github.com/draganagrbic998/sbnz/blob/main/class.png" alt="drawing"/>
</div>

## База знања
Базу знања система чини пет група правила. То су правила која дефинишу политику отварања штедног рачуна, располагања средствима штедног рачуна, уплате средстава, продужења орочења и превременог гашења рачуна.

### 1. Правила за отварање штедног рачуна
Група правила која дефинишу предуслове отварања штедног рачуна и начине на који се рачунају каматне стопе које ће се користити приликом месечног обрачуна средстава.

#### А. Противуслови отварања штедног рачуна
Правила која дефинишу недозвољене ситуације приликом захтева за отварањем рачуна. Уколико је барем једна од ситуација задовољена, отварање рачуна биће спречено.

##### Отварање штедног рачуна је онемогућено у следећим случајевима:
- Корисник је одабрао динарски рачун са главницом мањом од 10.000 РСД.
- Корисник је одабрао динарски рачун са главницом већом од 10.000.000 РСД.
- Корисник је одабрао динарски рачун са бројем месеци мањим од 4.
- Корисник је одабрао динарски рачун са бројем месеци већим од 42.
- Корисник је одабрао динарски рачун са главницом која када би се скинула са главног рачуна, на њему не би остало барем 200 РСД.
- Корисник је малолетан и одабрао је динарски рачун са главницом већом од 100.000 РСД.
- Корисник је малолетан и одабрао је динарски рачун, а већ поседује два активна динарска рачуна.
- Корисник је одабрао девизни рачун са главницом мањом од 100 јединица валуте.
- Корисник је одабрао девизни рачун са главницом већом од 100.000 јединица валуте.
- Корисник је одабрао девизни рачун са бројем месеци мањим од 2.
- Корисник је одабрао девизни рачун са бројем месеци већим од 36.
- Корисник је одабрао девизни рачун са главницом која када би се скинула са главног рачуна, на њему не би остало барем 1.000 РСД.
- Корисник је малолетан и одабрао је девизни рачун са главницом већом од 1.000 јединица валуте.
- Корисник је малолетан и одабрао је девизни рачун, а већ поседује активан девизни рачун.

#### Б. Правила за рачунање номиналне каматне стопе
Номинална каматна стопа служи за рачунање каматне стопе која се користи приликом месечног обрачуна средстава на рачуну. Рачуна се посебно за сваку валуту и одабран период орочења. Узима се најповољнија каматна стопа.

##### Камата износи 1.5%
- Корисник је одабрао динарски рачун са бројем месеци већим од 21 или главницом која када се подели са бројем месеци износи више од 100.000 РСД.
- Корисник је одабрао девизни рачун у еврима са бројем месеци већим од 30 или главницом која када се подели са бројем месеци износи више од 3.000 еври.
- Корисник је одабрао девизни рачун у америчким доларима са бројем месеци већим од 27 или главницом која када се подели са бројем месеци износи више од 2.900 долара.
- Корисник је одабрао девизни рачун у швајцарским францима са бројем месеци већим од 24 или главницом која када се подели са бројем месеци износи више од 2.800 франака.
- Корисник је одабрао девизни рачун у британским фунтама са бројем месеци већим од 33 или главницом која када се подели са бројем месеци износи више од 3.010 фунти.

##### Камата износи 1.2%
- Корисник је одабрао динарски рачун са бројем месеци већим од 15 или главницом која када се подели са бројем месеци износи више од 50.000 РСД.
- Корисник је одабрао девизни рачун у еврима са бројем месеци већим од 24 или главницом која када се подели са бројем месеци износи више од 2.000 еври.
- Корисник је одабрао девизни рачун у америчким доларима са бројем месеци већим од 21 или главницом која када се подели са бројем месеци износи више од 1.900 долара.
- Корисник је одабрао девизни рачун у швајцарским францима са бројем месеци већим од 18 или главницом која када се подели са бројем месеци износи више од 1.800 франака.
- Корисник је одабрао девизни рачун у британским фунтама са бројем месеци већим од 27 или главницом која када се подели са бројем месеци износи више од 2.100 фунти.

##### Камата износи 1.0%
- Корисник је одабрао динарски рачун са бројем месеци већим од 9 или главницом која када се подели са бројем месеци износи више од 30.000 РСД.
- Корисник је одабрао девизни рачун у еврима са бројем месеци већим од 18 или главницом која када се подели са бројем месеци износи више од 1.000 еври.
- Корисник је одабрао девизни рачун у америчким доларима са бројем месеци већим од 15 или главницом која када се подели са бројем месеци износи више од 900 долара.
- Корисник је одабрао девизни рачун у швајцарским францима са бројем месеци већим од 12 или главницом која када се подели са бројем месеци износи више од 800 франака.
- Корисник је одабрао девизни рачун у британским фунтама са бројем месеци већим од 21 или главницом која када се подели са бројем месеци износи више од 1.100 фунти.

##### Камата износи 0.8%
- Корисник је одабрао динарски рачун са бројем месеци већим од 6 или главницом која када се подели са бројем месеци износи више од 10.000 РСД.
- Корисник је одабрао девизни рачун у еврима са бројем месеци већим од 12 или главницом која када се подели са бројем месеци износи више од 500 еври.
- Корисник је одабрао девизни рачун у америчким доларима са бројем месеци већим од 9 или главницом која када се подели са бројем месеци износи више од 480 долара.
- Корисник је одабрао девизни рачун у швајцарским францима са бројем месеци већим од 6 или главницом која када се подели са бројем месеци износи више од 470 франака.
- Корисник је одабрао девизни рачун у британским фунтама са бројем месеци већим од 15 или главницом која када се подели са бројем месеци износи више од 520 фунти.

##### Камата износи 0.5%
- Корисник је одабрао динарски рачун са бројем месеци не већим од 6 и главницом која када се подели са бројем месеци износи не више од 10.000 РСД.
- Корисник је одабрао девизни рачун у еврима са бројем месеци не већим од 12 и главницом која када се подели са бројем месеци износи не више од 500 еври.
- Корисник је одабрао девизни рачун у америчким доларима са бројем месеци не већим од 9 и главницом која када се подели са бројем месеци износи не више од 480 долара.
- Корисник је одабрао девизни рачун у швајцарским францима са бројем месеци не већим од 6 и главницом која када се подели са бројем месеци износи не више од 470 франака.
- Корисник је одабрао девизни рачун у британским фунтама са бројем месеци не већим од 15 и главницом која када се подели са бројем месеци износи не више од 520 фунти.

#### В. Правила за рачунање бонус поена
Поред номиналне каматне стопе, у систем је укључена и могућност коришћења повластица - повољније камате уколико је корисник високо бодован, односно забележен као квалитетан клијент. За сваку подгрупу правила довољно је да је један од услова задовољен. Узима се најповољнији број поена.

##### 5 поена
- Корисник има отворен рачун у банци барем 5 година.
- У последњих 9 месеци кориснику је забележено отварање барем 2 динарска рачуна са главницом већом од 200.000 РСД.
- У последњих 12 месеци кориснику је забележено отварање барем 1 девизног рачуна са главницом већом од 2001 јединица валуте.
- У последњих 9 месеци просечна вредност главнице на свим динарским рачунима износи барем 100.000 РСД.
- У последњих 12 месеци просечна вредност главнице на свим девизним рачунима износи барем 1.000 јединица валуте.

##### 4 поена
- Корисник има отворен рачун у банци барем 4 године.
- У последњих 9 месеци кориснику је забележено отварање барем 2 динарска рачуна са бројем месеци већим од 12.
- У последњих 12 месеци кориснику је забележено отварање барем 1 девизног рачуна са бројем месеци већим од 9.
- У последњих 9 месеци сума свих главница на свим динарским рачунима износи барем 300.000 РСД.
- У последњих 12 месеци сума свих главница на свим девизним рачунима износи барем 3.000 јединица валуте.

##### 3 поена
- Корисник има отворен рачун у банци барем 3 године.
- У последњих 9 месеци кориснику је забележено отварање барем 2 динарска рачуна на којима је извршено више од 2 уплате са износом од барем 10.000 РСД.
- У последњих 12 месеци кориснику је забележено отварање барем 1 девизног рачуна на којем је извршено више од 1 уплате са износом од барем 100 јединица валуте.
- У последњих 9 месеци кориснику је забележено отварање барем 2 динарска рачуна на којима је сума свих уплата већа од 30% главнице.
- У последњих 12 месеци кориснику је забележено отварање барем 1 девизног рачуна на којем је сума свих уплата већа од 20% главнице.

##### 2 поена
- Корисник има отворен рачун у банци барем 2 године.
- У последњих 9 месеци кориснику је забележено отварање барем 2 динарска рачуна којима је главница већа од 50.000 РСД и просек свих уплата већи од 10.000 РСД.
- У последњих 12 месеци кориснику је забележено отварање барем 1 девизног рачуна којем је главница већа од 500 јединица валуте и просек свих уплата већи од 100 јединица валуте.
- У последњих 9 месеци кориснику је просек свих уплата на свим динарским рачунима барем 50.000 РСД.
- У последњих 12 месеци кориснику је просек свих уплата на свим девизним рачунима барем 500 јединица валуте.

##### 1 поен
- Корисник има отворен рачун у банци барем 1 годину.
- У последњих 9 месеци кориснику је забележено отварање барем 2 динарска рачуна којима је број месеци већи од 6 и сума свих уплата већа од 10.000 РСД.
- У последњих 12 месеци кориснику је забележено отварање барем 1 девизног рачуна којем је број месеци већи од 3 и сума свих уплата већа од 100 јединица валуте.
- У последњих 9 месеци кориснику је сума свих уплата на свим динарским рачунима барем 80.000 РСД.
- У последњих 12 месеци кориснику је сума свих уплата на свим девизним рачунима барем 800 јединица валуте.

#### Г. Правила за рачунање ефективне каматне стопе
Ефективна каматна стопа представља коначну каматну стопу која се користи приликом месечног обрачуна средстава на штедном рачуну. Представља проценат номиналне каматне стопе и рачуна се на основу поена клијента и статуса претходно отворених рачуна. За сваку подгрупу правила довољно је да је један од услова задовољен. Узима се најповољнија каматна стопа.

##### Камата износи 100% и корисник добија награду од 5000 динара
- Корисник је бодован са 7 поена.
- Корисник отвара први динарски рачун.
- Корисник отвара први девизни рачун.

##### Камата износи 98% и корисник добија награду од 2000 динара
- Корисник је бодован са 5 поена.
- Корисник отвара други динарски рачун, али је први истекао.
- Корисник отвара други девизни рачун, али је први истекао.

##### Камата износи 95% и корисник добија награду од 1000 динара
- Корисник је бодован са 4 поена.
- Корисник отвара други динарски рачун, али је први још увек активан или превремено затворен.
- Корисник отвара други девизни рачун, али је први још увек активан или превремено затворен.

##### Камата износи 90% и корисник добија награду од 500 динара
- Корисник је бодован са 2 поена.
- Корисник отвара трећи динарски рачун, али су оба претходна истекла.
- Корисник отвара трећи девизни рачун, али су оба претходна истекла.

##### Камата износи 87% и корисник добија награду од 200 динара
- Корисник је бодован са 1 поена.
- Корисник отвара трећи динарски рачун, али бар један од претходна два је активан или превремено затворен.
- Корисник отвара трећи девизни рачун, али бар један од претходна два је активан или превремено затворен.

##### Камата износи 85%
- Корисник је бодован са 0 поена.
- Корисник отвара динарски рачун, а већ поседује барем 3 динарска рачуна.
- Корисник отвара девизни рачун, а већ поседује барем 3 девизна рачуна.

#### Д. Дијаграм повезивања правила за отварање штедног рачуна
Групу правила за отварање штедног рачуна чини четири слоја - слој за откривање недозвољених ситуација, слој за рачунање номиналне каматне стопе, слој за рачунање бонус поена и слој за рачунање ефективне каматне стопе. Правила се повезују редоследом којим су наведени, што се види на слици испод. Наиме, прво се извршавају правила која откривају недозвољене ситуације. Затим, ако се није десила ниједна недозвољена ситуација, позивају се правила за рачунање номиналне каматне стопе. Након тога, позивају се правила за рачунање бонус поена, и на крају се рачуна ефективна каматна стопа. Излаз из ова четири слоја представљају израчунате вредности номиналне и ефективне каматне стопе и бонус поени клијента, уколико се није десила нека забрањена ситуација. Уколико се пак десила, одговарајућа порука се приказује кориснику. У супротном, обавештава се о каматним стопама које би његов рачун имао и даје могућност да предложене услове прихати, или пак одбије.

<div align="center">
  <img src="https://github.com/draganagrbic998/sbnz/blob/main/diagram1.png" alt="drawing"/>
</div>

### 2. Правила за располагање средствима на штедном рачуну током трајања орочења
Правила која дефинишу недозвољене ситуације приликом захтева за повлачењем средстава са штедног рачуна. Уколико је барем једна од ситуација задовољена, повлачење новца биће спречено.

#### А. Противуслови за располагањем средствима

##### Располагање средствима је онемогућено у следећим случајевима:
- Корисник има отворен рачун у банци мање од годину дана.
- Прошло је мање од 10% периода орочења.
- Прошло је више од 90% периода орочења.
- Корисник је одабрао износ који је мањи од 5% износа на штедном рачуну.
- Корисник је одабрао износ који је већи од 40% износа на штедном рачуну.
- Корисник је одабрао једини активни динарски рачун.
- Корисник је одабрао једини активни девизни рачун.
- Корисник је одабрао динарски рачун, а већ му је забележено 4 повлачења са тог рачуна.
- Корисник је одабрао девизни рачун, а већ му је забележено 2 повлачења са тог рачуна.

##### Онемогућено је повлачење више од 32.5% износа на штедном рачуну током периода орочења уколико:
- Корисник је одабрао динарски рачун са главницом већом од 250000 РСД.
- Корисник је одабрао девизни рачун са главницом већом од 2500 јединица одабране валуте.
- Корисник је одабрао динарски рачун и поседује више од 2 активна динарска рачуна.
- Корисник је одабрао девизни рачун и поседује више од 3 активнa девизнa рачуна.

##### Онемогућено је повлачење више од 25% износа на штедном рачуну током периода орочења уколико:
- Корисник је одабрао динарски рачун са главницом већом од 175000 РСД.
- Корисник је одабрао девизни рачун са главницом већом од 1750 јединица одабране валуте.
- Корисник је одабрао динарски рачун и поседује више од 3 активна динарска рачуна.
- Корисник је одабрао девизни рачун и поседује више од 4 активна девизна рачуна.

##### Онемогућено је повлачење више од 15% износа на штедном рачуну током периода орочења уколико:
- Корисник је одабрао динарски рачун са главницом већом од 125000 РСД.
- Корисник је одабрао девизни рачун са главницом већом од 1250 јединица одабране валуте.
- Корисник је одабрао динарски рачун и поседује више од 4 активна динарска рачуна.
- Корисник је одабрао девизни рачун и поседује више од 5 активних девизних рачуна.

#### Б. Дијаграм повезивања правила за располагање средствима
Групу правила за располагање средствима рачуна чине два слоја - слој за откривање недозвољених ситуација и слој за обрачун средстава, односно повлачење новца са штедног рачуна. Први слој је описан претходним правилима и он позива други слој само ако се није десила нека недозвољена ситуација. Ако се десила, корисник се обавештава о грешци. У супротном, ивршава се други слој који умањује тренутни износ средстава на штедном рачуну и тај износ пребацује на главни рачун отворен у банци.

<div align="center">
  <img src="https://github.com/draganagrbic998/sbnz/blob/main/diagram2.png" alt="drawing"/>
</div>

### 3. Правила за уплату средстава на штедни рачун током трајања орочења
Група правила која дефинишу предуслове за уплату средстава на штедни рачун, као и начине корекције главнице и ефективне каматне стопе рачуна. 

#### А. Противуслови уплате средстава на штедни рачун
Правила која дефинишу недозвољене ситуације приликом захтева за уплатом средстава. Уколико је барем једна од ситуација задовољена, уплата ће бити спречена.

##### Уплата средстава је онемогућена у следећим случајевима:
- Корисник има отворен рачун у банци мање од годину дана.
- Прошло је мање од 5% периода орочења.
- Прошло је више од 95% периода орочења.
- Корисник је одабрао износ који је мањи од 10% износа на штедном рачуну.
- Корисник је одабрао износ који је већи од 35% износа на штедном рачуну.
- Корисник је одабрао динарски рачун са главницом мањом од 75000 РСД.
- Корисник је одабрао девизни рачун са главницом мањом од 750 јединица одабране валуте.
- Корисник је одабрао динарски рачун, а већ му је забележено 3 уплате на тај рачун.
- Корисник је одабрао девизни рачун, а већ му је забележена 1 уплата на тај рачун.

##### Онемогућена је уплата више од 30% постојећег износа на штедном рачуну током периода орочења уколико:
- Корисник је одабрао динарски рачун са главницом већом од 200000 РСД.
- Корисник је одабрао девизни рачун са главницом већом од 2000 јединица одабране валуте.
- Корисник је одабрао динарски рачун и поседује више од 2 активна динарска рачуна.
- Корисник је одабрао динарски рачун и до сада је на одабраном рачуну уплатио више од 65% износа почетне главнице.
- Корисник је одабрао девизни рачун и поседује више од 1 активног девизног рачуна.
- Корисник је одабрао девизни рачун и до сада је на одабраном рачуну уплатио више од 50% износа почетне главнице.

##### Онемогућена је уплата више од 25% постојећег износа на штедном рачуну током периода орочења уколико:
- Корисник је одабрао динарски рачун са главницом већом од 150000 РСД.
- Корисник је одабрао девизни рачун са главницом већом од 1500 јединица одабране валуте.
- Корисник је одабрао динарски рачун и поседује више од 3 активна динарска рачуна.
- Корисник је одабрао динарски рачун и до сада је на одабраном рачуну уплатио више од 80% износа почетне главнице.
- Корисник је одабрао девизни рачун и поседује више од 2 активна девизна рачуна.
- Корисник је одабрао девизни рачун и до сада је на одабраном рачуну уплатио више од 65% износа почетне главнице.

##### Онемогућена је уплата више од 20% постојећег износа на штедном рачуну током периода орочења уколико:
- Корисник је одабрао динарски рачун са главницом већом од 100000 РСД.
- Корисник је одабрао девизни рачун са главницом већом од 1000 јединица одабране валуте.
- Корисник је одабрао динарски рачун и поседује више од 4 активна динарска рачуна.
- Корисник је одабрао динарски рачун и до сада је на одабраном рачуну уплатио више од 95% износа почетне главнице.
- Корисник је одабрао девизни рачун и поседује више од 3 активна девизна рачуна.
- Корисник је одабрао девизни рачун и до сада је на одабраном рачуну уплатио више од 80% износа почетне главнице.

#### Б. Правила за корекцију главнице приликом уплате додатних средстава
Правила која дефинишу начин на који се коригује главница приликом уплате, у зависности од претходног стања рачуна и количине саме уплате. За сваку подгрупу правила довољно је да је један од услова задовољен. Узима се најповољнија корекција главнице.

##### Главница се увећава за 90% уплате
- Уплата износи више од 20% износа главнице.
- Стање на динарском рачуну износи више од 300000 РСД.
- Стање на девизном рачуну износи више од 3000 јединица одабране валуте.
- Корисник је током последњих 9 месеци на одабраном рачуну уплатио више од 50% износа почетне главнице.

##### Главница се увећава за 80% уплате
- Уплата износи више од 14% износа главнице.
- Стање на динарском рачуну износи више од 250000 РСД.
- Стање на девизном рачуну износи више од 2500 јединица одабране валуте.
- Корисник је током последњих 8 месеци на одабраном рачуну уплатио више од 45% износа почетне главнице.

##### Главница се увећава за 70% уплате
- Уплата износи више од 11% износа главнице.
- Стање на динарском рачуну износи више од 200000 РСД.
- Стање на девизном рачуну износи више од 2000 јединица одабране валуте.
- Корисник је током последњих 7 месеци на одабраном рачуну уплатио више од 40% износа почетне главнице.

##### Главница се увећава за 60% уплате
- Уплата износи више од 8% износа главнице.
- Стање на динарском рачуну износи више од 150000 РСД.
- Стање на девизном рачуну износи више од 1500 јединица одабране валуте.
- Корисник је током последњих 6 месеци на одабраном рачуну уплатио више од 35% износа почетне главнице.

##### Главница се увећава за 50% уплате
- Уплата износи не више од 8% износа главнице.
- Стање на динарском рачуну износи не више од 150000 РСД.
- Стање на девизном рачуну износи не више од 1500 јединица одабране валуте.
- Корисник је током последњих 5 месеци на одабраном рачуну уплатио више од 30% износа почетне главнице.

#### В. Правила за корекцију ефективне каматне стопе приликом уплате додатних средстава
Правила која дефинишу начин на који се коригује ефективна каматна стопа, у зависности од претходног стања рачуна и количине саме уплате. За сваку подгрупу правила довољно је да је један од услова задовољен. Узима се највеће умањење каматне стопе.

##### Камата се умањује за 3%
- Уплата износи више од 18% износа новоизрачунате главнице.
- Стање на динарском рачуну износи више од 330000 РСД.
- Стање на девизном рачуну износи више од 3300 јединица одабране валуте.
- Корисник је током последњих 12 месеци на динарским рачунима уплатио у просеку више од 50% износа почетне главнице.
- Корисник је током последњих 11 месеци на девизним рачунима уплатио у просеку више од 45% износа почетне главнице.

##### Камата се умањује за 2.5%
- Уплата износи више од 15% износа новоизрачунате главнице.
- Стање на динарском рачуну износи више од 270000 РСД.
- Стање на девизном рачуну износи више од 2700 јединица одабране валуте.
- Корисник је током последњих 11 месеци на динарским рачунима уплатио у просеку више од 45% износа почетне главнице.
- Корисник је током последњих 10 месеци на девизним рачунима уплатио у просеку више од 40% износа почетне главнице.

##### Камата се умањује за 2%
- Уплата износи више од 10% износа новоизрачунате главнице.
- Стање на динарском рачуну износи више од 220000 РСД.
- Стање на девизном рачуну износи више од 2200 јединица одабране валуте.
- Корисник је током последњих 10 месеци на динарским рачунима уплатио у просеку више од 40% износа почетне главнице.
- Корисник је током последњих 9 месеци на девизним рачунима уплатио у просеку више од 35% износа почетне главнице.

##### Камата се умањује за 1.5%
- Уплата износи више од 5% износа новоизрачунате главнице.
- Стање на динарском рачуну износи више од 180000 РСД.
- Стање на девизном рачуну износи више од 1800 јединица одабране валуте.
- Корисник је током последњих 9 месеци на динарским рачунима уплатио у просеку више од 35% износа почетне главнице.
- Корисник је током последњих 8 месеци на девизним рачунима уплатио у просеку више од 30% износа почетне главнице.

##### Камата се умањује за 1%
- Уплата износи не више од 5% износа новоизрачунате главнице.
- Стање на динарском рачуну износи не више од 180000 РСД.
- Стање на девизном рачуну износи не више од 1800 јединица одабране валуте.
- Корисник је током последњих 8 месеци на динарским рачунима уплатио у просеку више од 30% износа почетне главнице.
- Корисник је током последњих 7 месеци на девизним рачунима уплатио у просеку више од 25% износа почетне главнице.

#### Г. Дијаграм повезивања правила за уплату средстава
Групу правила за уплату средстава на штедни рачун чини четири слоја - слој за откривање недозвољених ситуација, слој за обрачун средстава на главном рачуну, слој за корекцију главнице штедног рачуна и слој за корекцију ефективне каматне стопе. Слојеви се повезују редоследом којим су наведени, што се види на слици испод. Прво се извршавају правила која проверавају да ли се десила нека од недозвољених ситуација. Уколико није, позива се други слој који умањује стање на главном рачуну. Потом се позивају правила за корекцију главнице, а потом правила за корекцију ефективне каматне стопе. На излазу из сва четири слоја налази се рачун са новим вредностима главнице и каматне стопе, уколико се није десила нека забрањена ситуација. Уколико се десила, на излазу ће се наћи одговарајућа порука о грешци, а која ће се приказати кориснику.

<div align="center">
  <img src="https://github.com/draganagrbic998/sbnz/blob/main/diagram3.png" alt="drawing"/>
</div>

### 4. Правила за продужење орочења штедног рачуна
Група правила која дефинишу предуслове за продужење орочења активног рачуна, као и начине корекције каматне стопе приликом одобреног продужења.

#### А. Противуслови продужења орочења
Правила која дефинишу недозвољене ситуације приликом захтева за продужењем орочења. Уколико је бар једна од ситуација задовољена, продужетак ће бити спречен.

##### Продужење орочења је онемогућено у следећим случајевима:
- Корисник је одабрао мање од 3 месеца продужења.
- Корисник је одабрао више од 24 месеца продужења.
- Корисник је одабрао динарску штедњу са минималним периодом орочења од 3 месеца.
- Корисник је одабрао динарску штедњу са периодом орочења од барем 42 месеца.
- Корисник је одабрао девизну штедњу са минималним периодом орочења од 1 месеца.
- Корисник је одабрао девизну штедњу са периодом орочења од барем 36 месеци.
- Корисник је одабрао динарску штедњу са главницом мањом од 75000 РСД.
- Корисник је одабрао девизну штедњу са главницом мањом од 750 јединица одабране валуте.

##### Онемогућено је продужење орочења на више од 18 месеци уколико:
- Корисник је одабрао динарску штедњу са главницом мањом од 250000 РСД.
- Корисник је одабрао девизну штедњу са главницом мањом од 2500 јединица одабране валуте.
- Корисник је одабран рачун већ једном продужио.

##### Онемогућено је продужење орочења на више од 12 месеци уколико:
- Корисник је одабрао динарску штедњу са главницом мањом од 200000 РСД.
- Корисник је одабрао девизну штедњу са главницом мањом од 2000 јединица одабране валуте.
- Корисник је одабран рачун већ 2 пута продужио.

##### Онемогућено је продужење орочења на више од 9 месеци уколико:
- Корисник је одабрао динарску штедњу са главницом мањом од 150000 РСД.
- Корисник је одабрао девизну штедњу са главницом мањом од 1500 јединица одабране валуте.
- Корисник је одабран рачун већ 3 пута продужио.

##### Онемогућено је продужење орочења на више од 6 месеци уколико:
- Корисник је одабрао динарску штедњу са главницом мањом од 100000 РСД.
- Корисник је одабрао девизну штедњу са главницом мањом од 1000 јединица одабране валуте.
- Корисник је одабран рачун већ 5 пута продужио.

#### Б. Правила за корекцију ефективне каматне стопе приликом продужења орочења
Правила која дефинишу начин на који се коригује ефективна каматна стопа приликом одобреног продужења орочења. За сваку подгрупу правила довољно је да је један од услова задовољен. Узима се најповољнија корекција каматне стопе.

##### Камата се увећава за 2.5%
- Орочење је продужено за више од 16 месеци.
- Стање на динарском рачуну износи више од 270000 РСД.
- Стање на девизном рачуну износи више од 2700 јединица одабране валуте.
- Корисник је током последњих 24 месеца продужио динарске рачуне у просеку за више од 15 месеци.
- Корисник је током последњих 21 месеци продужио девизне рачуне у просеку за више од 14 месеци.

##### Камата се увећава за 2%
- Орочење је продужено за више од 13 месеци.
- Стање на динарском рачуну износи више од 220000 РСД.
- Стање на девизном рачуну износи више од 2200 јединица одабране валуте.
- Корисник је током последњих 24 месеца продужио динарске рачуне у просеку за више од 12 месеци.
- Корисник је током последњих 21 месеци продужио девизне рачуне у просеку за више од 11 месеци.

##### Камата се увећава за 1.5%
- Орочење је продужено за више од 9 месеци.
- Стање на динарском рачуну износи више од 170000 РСД.
- Стање на девизном рачуну износи више од 1700 јединица одабране валуте.
- Корисник је током последњих 24 месеца продужио динарске рачуне у просеку за више од 9 месеци.
- Корисник је током последњих 21 месеци продужио девизне рачуне у просеку за више од 8 месеци.

##### Камата се увећава за 1%
- Орочење је продужено за више од 5 месеци.
- Стање на динарском рачуну износи више од 120000 РСД.
- Стање на девизном рачуну износи више од 1200 јединица одабране валуте.
- Корисник је током последњих 24 месеца продужио динарске рачуне у просеку за више од 7 месеци.
- Корисник је током последњих 21 месеци продужио девизне рачуне у просеку за више од 6 месеци.

##### Камата се увећава за 0.5%
- Орочење је продужено за не више од 5 месеци.
- Стање на динарском рачуну износи не више од 120000 РСД.
- Стање на девизном рачуну износи не више од 1200 јединица одабране валуте.
- Корисник је током последњих 24 месеца продужио динарске рачуне у просеку за више од 4 месеца.
- Корисник је током последњих 21 месеци продужио девизне рачуне у просеку за више од 3 месеца.

#### В. Дијаграм повезивања правила за продужење орочења
Групу правила за продужење орочења чини три слоја - слој за откривање недозвољених ситуација, слог који продужава период орочења и слој за корекцију ефективне каматне стопе. Слојеви су повезани радоследом којим су наведени, што се види на слици сипод. Прво се извршавају правила која проверавају да ли се десила недозвољена ситуација. Уколико није, позива се слој који продужава период орочења, а после њега се позивају правила која коригују каматну стопу рачуна. На излази из сва три слоја ће се наћи рачун са новом вредношћу каматне стопе и новим периодом орочења. Уколико се десила нека забрањена ситуација, на излазу ће се наћи порука о грешци, која се потом може приказати кориснику.

<div align="center">
  <img src="https://github.com/draganagrbic998/sbnz/blob/main/diagram4.png" alt="drawing"/>
</div>

### 5. Правила за превремено гашење штедног рачуна
Правила која дефинишу недозвољене ситуације у случају захтева за превременим гашењем рачуна. Уколико је бар једна од ситуација задовољена, гашење рачуна биће спречено.

#### А. Противуслови превременог гашења штедног рачуна

##### Превремено гашење штедног рачуна је онемогућено у следећим случајевима:
- Прошло је мање од 20% периода орочења.
- Прошло је више од 80% периода орочења.
- Главница динарског рачуна износи мање од 20000 РСД.
- Главница девизног рачуна износи мање од 200 јединица одабране валуте.
- Корисник је одабрао једини активни динарски рачун.
- Корисник је одабрао једини активни девизни рачун.
- Корисник је одабрао динарски рачун, а већ му је забележено превремено гашење 6 динарских рачуна.
- Корисник је одабрао девизни рачун, а већ му је забележено превремено гашење 4 девизна рачуна.

#### Б. Дијаграм повезивања правила за гашење штедног рачуна
Групу правила за гашење штедног рачуна чине два слоја - слој за отркивање недозвољених ситуација и слој који врши само гашење рачуна. Први слој је описан претходним правилима и он позива други само ако се није десила нека недозвољена ситуација. Ако се десила, корисник се обавештава о неуспеху. У супротном, позива се други слој и он прекида важење штедног рачуна.

<div align="center">
  <img src="https://github.com/draganagrbic998/sbnz/blob/main/diagram5.png" alt="drawing"/>
</div>

## Пример резоновања
Сценарио је дат на примеру отварања штедног рачуна. 

- Клијент је одабрао отварање новог штедног рачуна. Одабрао је динарски рачун, унео је 1500.0 РСД као главницу и 9 као број месеци.
- Покрећу се правила за проверу недозвољених ситуација:
	- Проверава се да ли је број месеци мањи од 3. Пошто у конкретном случају није, прелази се на следеће правило.
	- Проверава се да ли је број месеци већи од 42. Пошто у конкретном случају није, прелази се на следеће правило.
	- Проверава се да ли је одабрана главница мања од 1.000 РСД. Пошто у конкретном случају није, прелази се на следеће правило.
	- Проверава се да ли је одабрана главница већа од 1.000.000 РСД. Пошто у конкретном случају није, прелази се на следеће правило.
	- Проверава се да ли је ово клијентов први динарски рачун и да ли је у том случају број месеци мањи од 6. Пошто је у конкретном случају забележено у систему да корисник већ има отворене динарске рачуне, а додатно број месеци није мањи од 6, прелази се на следеће правило.
	- Проверава се да ли корисник већ поседује више од 4 активна динарска рачуна. Пошто је у конкретном случају забележено у систему да корисник нема више од 4 активна динарска рачуна, прелази се на следеће правило.
	- Проверава се да ли главни клијентски рачун има барем 200 РСД више од одабране главнице. Пошто је у конкретном случају забележено у систему да корисник има на главном рачуну довољно средстава, прелази се на следеће правило.
	- Пошто више нема правила за откривање недозвољених ситуација, убацује се помоћни објекат у меморију и тиме покрећу правила за рачунање номиналне каматне стопе, јер је њима постојање тог објекта предуслов. Да се десила нека недозвољена ситуација, убацио би се у меморију објекат који је индикатор грешке и тиме би се спречило извршавање свих осталих правила, јер је њима предуслов непостојање таквог објекта. 
- Покрећу се правила за рачунање номиналне каматне стопе:
	-  Проверавају се правила из прве групе која претпостављају каматну стопу од 1.5%.
	-  Проверава се да ли је у питању динарски рачун са бројем месеци већим од 20. Пошто у конкретном случају није, прелази се на следеће правило.
	-  Проверава се да ли је у питању девизни рачун у еврима са бројем месеци већим од 30. Пошто у конкретном случају није, прелази се на следећу девизну валуту. Пошто се установи да није у питању ниједна девизна валута, прелази се на следећу групу правила.
	-  Проверавају се правила из друге групе која претпостављају каматну стопу од 1.2%.
	-  Проверава се да ли је у питању динарски рачун са бројем месеци већим од 15. Пошто у конкретном случају није, прелази се на следеће правило.
	-  Проверава се да ли је у питању девизни рачун у еврима са бројем месеци већим од 15. Пошто у конкретном случају није, прелази се на следећу валуту. Пошто се установи да није у питању ниједна девизна валута, прелази се на следећу групу правила.
	-  Проверавају се правила из треће групе која претпостављају каматну стопу од 1.0%
	-  Проверава се да ли је у питању динарски рачун са бројем месеци већим од 8. Пошто у конкретном случају јесте, извршава се акција која мења помоћни објекат, постављајући му поље номиналне каматне стопе са досадашње null вредности на 1.0. Овим се спречава извршавање било којих других правила за рачунање номиналне каматне стопе јер је њима предуслов да је то поље null. Додатно, покрећу се правила за рачунање бонус поена јер је њима предуслов да то поље није null.
-  Покрећу се правила за рачунање бонус поена:
	- Проваравају се правила из прве групе која претпостављају 10 бонус поена.
	- Проверава се да ли је корисник клијент банке барем 10 година. Пошто је у конкретном случају забележено да није, прелази се на следеће правило.
	- Проверава се да ли корисник претходно ниједном није превремено угасио рачун. Пошто је у конкретном случају забележено да јесте, прелази се на следеће правило.
	- Проверава се да ли корисник претходно није ниједном вршио уплату на штедни рачун пре истека орочења. Пошто је у конкретном случају забележено да јесте, прелази се на следеће правило.
	- Проверава се да ли корисник претходно није ниједном вршио повлачење новца са штедног рачуна пре истека орочења. Пошто је у конкретном случају забележено да није, извршава се акција која мења помоћни објекат тако што му поставља поље за бонус поене са досадашље null вредности на 10. Овим се спречава извршавање свих осталих правила за рачунање бонус поена, јер је њима предуслов да је то поље null. Додатно, покрећу се правила за рачунање ефективне каматне стопе, јер је њима предуслов да то поље није null.
- Покрећу се правила за рачунање ефективне каматне стопе:
	- Проверавају се правила из прве групе која претпостављају ефективну каматну стопу од 100%.
	- Проверава се да ли је корисник бодован са 10 поена. Пошто у конкретном случају јесте, мења се помоћни објекат тако што му се поставља поље ефективне каматне стопе са досадашње null вредности на 100.0. Тиме се спречава извршавање осталих правила за рачунање ефективне каматне стопе, јер је њима предуслов да је то поље null.
	- Пошто након последње измене помоћног објекта ниједној групи правила више нису задовољени предуслови, резоновање се прекида и израчунате вредности каматних стопа и бонус поена враћају кориснику.
